<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>所有用户评测结果</title>
<link rel="stylesheet" href="/static/css/admin_result_list.css">
</head>
<body>
<header>
    <h1>所有用户评测结果</h1>
    <div class="user-info">
        <button onclick="window.location.href='/problems'">题目列表</button>
    </div>
</header>

<div class="container">
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="搜索评测ID、题目ID、题目标题或用户名..." onkeyup="filterTable()"/>
    </div>

    <table id="resultTable">
        <thead>
            <tr>
                <th>评测 ID</th>
                <th>用户</th>
                <th>题目 ID</th>
                <th>题目标题</th>
                <th>时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
        {% for r in results %}
            <tr>
                <td>{{ r.result_id }}</td>
                <td>{{ r.username }} ({{ r.userid }})</td>
                <td>{{ r.problemid }}</td>
                <td>{{ r.title }}</td>
                <td>{{ r.time }}</td>
                <td><a class="button" href="{{ url_for('results', userid=r.userid, resultid=r.result_id) }}">查看详情</a></td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <ul class="pagination">
        <li><a href="{{ url_for('admin_results', page=page-1, search=search) }}" class="{% if page==1 %}disabled{% endif %}">上一页</a></li>
        {% for i in range(1, total_pages + 1) %}
            <li><a href="{{ url_for('admin_results', page=i, search=search) }}" class="{% if i==page %}active{% endif %}">{{ i }}</a></li>
        {% endfor %}
        <li><a href="{{ url_for('admin_results', page=page+1, search=search) }}" class="{% if page==total_pages %}disabled{% endif %}">下一页</a></li>
    </ul>
</div>

<div class="footer">
    <p>&copy; 2025 BCMOJ. Released under the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a>. | <a href="/about">关于我们</a></p>
</div>

<script>
function filterTable() {
    const input = document.getElementById("searchInput");
    const filter = input.value.toLowerCase();
    const table = document.getElementById("resultTable");
    const trs = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr");
    for (let i = 0; i < trs.length; i++) {
        const tds = trs[i].getElementsByTagName("td");
        let show = false;
        for (let j = 0; j < 4; j++) {
            if (tds[j].textContent.toLowerCase().includes(filter)) {
                show = true;
                break;
            }
        }
        trs[i].style.display = show ? "" : "none";
    }
}
</script>
</body>
</html>
