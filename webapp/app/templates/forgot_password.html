<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>忘记密码</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/forgot_password.css">

</head>
<body>
    <div class="toast-container"></div>
    <div class="page-wrapper">
        <div class="forgot-container">
            <h1><i class="bi bi-key me-2"></i>忘记密码</h1>

            {% if step == 1 %}
            <form method="POST" action="{{ url_for('forgot_password') }}">
                <div class="form-group">
                    <label for="email"><i class="bi bi-envelope me-1"></i>邮箱</label>
                    <input type="email" class="form-control" id="email" name="email" required placeholder="请输入注册邮箱">
                </div>
                <button type="submit" class="btn btn-action"><i class="bi bi-send me-2"></i>发送验证码</button>
            </form>
            {% elif step == 2 %}
            <form method="POST" action="{{ url_for('forgot_password') }}">
                <div class="form-group">
                    <label for="verification_code"><i class="bi bi-shield-lock me-1"></i>验证码</label>
                    <input type="text" class="form-control" id="verification_code" name="verification_code" required placeholder="请输入验证码">
                </div>
                <div class="form-group">
                    <label for="new_password"><i class="bi bi-lock me-1"></i>新密码</label>
                    <input type="password" class="form-control" id="new_password" name="new_password" required placeholder="请输入新密码">
                </div>
                <div class="form-group">
                    <label for="confirm_password"><i class="bi bi-lock me-1"></i>确认密码</label>
                    <input type="password" class="form-control" id="confirm_password" name="confirm_password" required placeholder="请再次输入新密码">
                </div>
                <button type="submit" class="btn btn-action"><i class="bi bi-arrow-repeat me-2"></i>重置密码</button>
            </form>
            {% endif %}

            <div class="links">
                <a href="{{ url_for('login') }}">返回登录</a>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 BCMOJ. Released under the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a>. | <a href="/about">关于我们</a></p>
    </div>
    <script src="/static/js/popper.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script>
    function showToast(message, type = 'info', title = '系统通知') {
        const toastContainer = document.querySelector('.toast-container');
        const toastId = 'toast-' + Date.now();
        let icon = 'bi-info-circle';
        if (type === 'success') icon = 'bi-check-circle';
        else if (type === 'error') icon = 'bi-x-circle';
        else if (type === 'warning') icon = 'bi-exclamation-circle';
        const toastEl = document.createElement('div');
        toastEl.className = `toast toast-${type}`;
        toastEl.id = toastId;
        toastEl.setAttribute('role', 'alert');
        toastEl.setAttribute('aria-live', 'assertive');
        toastEl.setAttribute('aria-atomic', 'true');
        toastEl.innerHTML = `
            <div class="toast-header">
                <i class="bi ${icon} me-2"></i>
                <strong class="me-auto">${title}</strong>
                <small>刚刚</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        `;
        toastContainer.appendChild(toastEl);
        const toast = new bootstrap.Toast(toastEl, {
            delay: 5000
        });
        toast.show();
        toastEl.addEventListener('hidden.bs.toast', function () {
            toastEl.remove();
        });
    }
    document.addEventListener('DOMContentLoaded', function () {
        const flashMessages = {{ get_flashed_messages(with_categories=true) | tojson }};
        flashMessages.forEach(([category, message]) => {
            showToast(
                message,
                category,
                category === 'success' ? '操作成功' :
                category === 'error' ? '发生错误' :
                category === 'warning' ? '警告' : '系统通知'
            );
        });
    });
</script>
</body>
</html>
